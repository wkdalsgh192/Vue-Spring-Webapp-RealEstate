<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.happyhouse.model.mapper.HouseMapMapper">
	
	<select id="getDongInGugun" resultType="HashMap" parameterType="string">
	    <![CDATA[SELECT distinct dong, dongcode FROM dongcode WHERE substring(dongcode, 1, 5) = #{gugun} ORDER BY dong]]>
	</select>
	
	<select id="searchApt" resultType="houseinfo" parameterType="String">
		<![CDATA[
		select no, dong, code, info.AptName, jibun, lat, lng, price, area, date 
		from 
			(select AptName, dealAmount price, area, str_to_date(concat(dealYear,"-",dealMonth,"-",dealDay), '%Y-%m-%d') as date 
			from housedeal group by AptName order by date desc) as info 
		inner join 
			(select no, dong, code, AptName, jibun, lat, lng 
			from houseinfo info
			where info.code in (select base.code from baseaddress base where concat(city,' ',gugun,' ',dong) like #{ address })) as deal 
		on info.AptName = deal.AptName;
		]]>
	</select>
	
	<insert id="addLike" parameterType="houselike">
		 <![CDATA[insert into interestarea (id, apt_name, price, area, last_update) values (#{id}, #{apt_name}, #{price}, #{area}, #{last_update});]]>
	</insert>
	
	<select id="checkPrice" resultType="housedeal" parameterType="String">
		<![CDATA[select no, dong, AptName apt_name, dealAmount deal_amount, date_format(str_to_date(concat(dealYear,'-',dealMonth,'-',dealDay), '%Y-%m-%d'), '%m-%d') as deal_date 
		from housedeal where AptName = #{AptName} order by deal_date;]]>
	</select>

</mapper>